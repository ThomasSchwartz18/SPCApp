{% extends 'base.html' %}
{% import 'components/forms.html' as forms %}
{% block title %}Verified Part Markings{% endblock %}
{% block head_extra %}
  <script src="/static/js/part_markings.js" defer></script>
{% endblock %}
{% block content %}
  <h1>Verified Part Markings</h1>
  <div id="container">
    <div id="markings-actions">
      <div class="action-panel">
        <div class="action-card">
          <h2>Search Verified Part</h2>
          <p class="desc">Enter a part number to highlight it in the table.</p>
          {{ forms.text_input('search-part-number', 'Part Number', placeholder='e.g., 10-1000', help='Highlight matching part number in the table.', id='search-part-number', title='Part number to locate') }}
          {{ forms.button('Search', type='button', id='search-btn', title='Highlight matching part number') }}
        </div>
        {% if is_admin or permissions['part_markings'] %}
        <div class="action-card">
          <h2>Add New Entry</h2>
          <p class="desc">Use this form to add a single verified part marking.</p>
          <form method="post" class="needs-validation" novalidate>
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            {{ forms.text_input('part_number', 'Part Number', required=True, title='Unique part number') }}
            {{ forms.text_input('mfg_number1', 'Mfg Number 1', title='Manufacturer number 1') }}
            {{ forms.text_input('mfg_number2', 'Mfg Number 2', title='Manufacturer number 2') }}
            {{ forms.text_input('manufacturer', 'Manufacturer', title='Manufacturer name') }}
            {{ forms.text_input('verified_markings', 'Verified Markings', title='Verified markings text') }}
            <p class="field-desc">Add the new part marking to the table.</p>
            {{ forms.button('Add', title='Add new part marking') }}
          </form>
        </div>
        <div class="action-card">
          <h2>Bulk Upload</h2>
          <p class="desc">Upload an Excel file to add multiple entries at once.</p>
          <form method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            {{ forms.text_input('excel_file', 'Excel File', type='file', required=True, title='Excel file containing part markings') }}
            <p class="field-desc">Import rows from the selected spreadsheet.</p>
            {{ forms.button('Upload', title='Upload spreadsheet') }}
          </form>
        </div>
        {% endif %}
      </div>
    </div>
    <div id="divider"></div>
    <div id="markings-table">
      <table class="editable" data-update-url="/part-markings" data-fields="verified_markings,manufacturer,mfg_number2,mfg_number1,part_number">
        <thead>
          <tr>
            <th>Verified Markings</th>
            <th>Manufacturer</th>
            <th>Mfg Number 2</th>
            <th>Mfg Number 1</th>
            <th>Part Number</th>
            {% if is_admin or permissions['part_markings'] %}
            <th>Actions</th>
            {% endif %}
          </tr>
        </thead>
        <tbody>
          {% for row in markings %}
          <tr data-id="{{ row['id'] }}">
            <td>{{ row['verified_markings'] }}</td>
            <td>{{ row['manufacturer'] }}</td>
            <td>{{ row['mfg_number2'] }}</td>
            <td>{{ row['mfg_number1'] }}</td>
            <td class="part-number">{{ row['part_number'] }}</td>
            {% if is_admin or permissions['part_markings'] %}
            <td class="no-edit"><button type="button" class="delete-row" title="Delete row">Delete</button></td>
            {% endif %}
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% endblock %}
