{% extends 'base.html' %}
{% block title %}Data Analysis - PPM MOAT & Control Chart{% endblock %}
{% block head_extra %}
  <!-- Chart.js for control chart rendering -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
    <script src="{{ url_for('static', filename='js/html2canvas.min.js') }}" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.plugin.png.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.plugin.jpeg.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.25/dist/jspdf.plugin.autotable.min.js" defer></script>
    <script src="{{ url_for('static', filename='js/report_utils.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/tabs.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/std_chart.js') }}" defer></script>
    <script src="/static/js/analysis.js" defer></script>
    <script src="{{ url_for('static', filename='js/moat_sql.js') }}" defer></script>
{% endblock %}
{% block content %}
  <h1>Data Analysis - PPM MOAT</h1>
  {% if not show_moat %}
    <div style="display:flex; flex-direction:column; gap:10px; width:fit-content;">
      <button onclick="window.location='{{ url_for('analysis') }}?view=moat'">View PPM Reports</button>
      <button onclick="window.location='{{ url_for('compare_aoi_fi') }}'">Compare AOI vs Final Inspect</button>
    </div>
  {% else %}
    <div class="moat-stats">
      {% if total_rows %}
        Total rows: {{ total_rows }} | Report date range: {{ earliest }} - {{ latest }}
        {% if is_admin or permissions['analysis'] %}
        &nbsp;|&nbsp;
        <button id="show-uploads-btn" title="View or delete previously uploaded reports">Manage Uploads</button>
        {% endif %}
      {% endif %}
    </div>
    <div id="container">
      <div id="analysis-actions">
        <nav class="tab-nav">
          <button class="tab-link active" data-tab="actions-tab" data-desc="Upload and chart PPM reports." data-more="Import reports and configure control charts to analyze false call rates.">Actions</button>
          <button class="tab-link" data-tab="reports-tab" data-desc="Browse uploaded reports." data-more="View previously uploaded PPM reports and export data.">Reports</button>
        </nav>
        <div id="actions-tab" class="tab-content active">
          <div class="action-panel">
            {% if is_admin or permissions['analysis'] %}
            <div class="action-card">
              <h2>Upload PPM Report</h2>
              <p class="desc">Import a PPM report (.xls or .xlsx) to analyze false call rates.</p>
              <form method="post" enctype="multipart/form-data">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <label for="ppm_report">Choose file</label>
                <input id="ppm_report" type="file" name="ppm_report" accept=".xls,.xlsx" required title="PPM report Excel file">
                <p class="field-desc">Upload the selected report for processing.</p>
                <button type="submit" title="Upload and analyze the report">Upload Report</button>
              </form>
            </div>
            {% endif %}
            <div class="action-card">
              <h2>Control Chart - Avg FCs</h2>
              <p class="desc">Configure options and generate a false call rate control chart.</p>
              <button id="control-chart-btn" title="Show or hide chart options">Control Chart Settings</button>
              <div id="chart-settings" style="display:none; margin-top:10px;">
                <label>Start Date
                  <input type="date" id="start-date" title="Start date for data range">
                </label><br>
                <label>End Date
                  <input type="date" id="end-date" title="End date for data range">
                </label><br>
                <label>Y Max
                  <input type="number" id="y-max" value="50" step="0.1" title="Maximum value for Y-axis">
                </label><br>
                <label>Min Boards
                  <input type="number" id="min-boards" value="7" title="Minimum boards required">
                </label><br>
                <label>Model Name
                  <input list="model-list" id="model-name-1" placeholder="Start typing..." title="Select model name">
                  <span id="model-name-and-2" style="display:none">and</span>
                  <input list="model-list" id="model-name-2" style="display:none" placeholder="Start typing..." title="Select model name">
                  <span id="model-name-and-3" style="display:none">and</span>
                  <input list="model-list" id="model-name-3" style="display:none" placeholder="Start typing..." title="Select model name">
                  <span id="model-name-and-4" style="display:none">and</span>
                  <input list="model-list" id="model-name-4" style="display:none" placeholder="Start typing..." title="Select model name">
                </label><br>
                <label>Lines
                  <select id="line-select-1">
                    <option value="all">All Lines</option>
                    <option value="offline">Line Offline</option>
                    <option value="0">Line 0</option>
                    <option value="1">Line 1</option>
                    <option value="2">Line 2</option>
                    <option value="3">Line 3</option>
                  </select>
                  <span id="line-and-2" style="display:none">and</span>
                  <select id="line-select-2" style="display:none">
                    <option value="">-- Select --</option>
                    <option value="offline">Line Offline</option>
                    <option value="0">Line 0</option>
                    <option value="1">Line 1</option>
                    <option value="2">Line 2</option>
                    <option value="3">Line 3</option>
                  </select>
                  <span id="line-and-3" style="display:none">and</span>
                  <select id="line-select-3" style="display:none">
                    <option value="">-- Select --</option>
                    <option value="offline">Line Offline</option>
                    <option value="0">Line 0</option>
                    <option value="1">Line 1</option>
                    <option value="2">Line 2</option>
                    <option value="3">Line 3</option>
                  </select>
                  <span id="line-and-4" style="display:none">and</span>
                  <select id="line-select-4" style="display:none">
                    <option value="">-- Select --</option>
                    <option value="offline">Line Offline</option>
                    <option value="0">Line 0</option>
                    <option value="1">Line 1</option>
                    <option value="2">Line 2</option>
                    <option value="3">Line 3</option>
                  </select>
                </label><br>
                <p class="field-desc">Generate the chart using the selected parameters.</p>
                <button id="run-chart-btn" title="Generate control chart">Run Chart</button>
              </div>
            </div>
            <div class="action-card">
              <h2>Control Chart - Avg NGs</h2>
              <p class="desc">Configure options and generate an NG rate control chart.</p>
              <button id="control-chart-ng-btn" title="Show or hide chart options">Control Chart Settings</button>
              <div id="chart-ng-settings" style="display:none; margin-top:10px;">
                <label>Start Date
                  <input type="date" id="ng-start-date" title="Start date for data range">
                </label><br>
                <label>End Date
                  <input type="date" id="ng-end-date" title="End date for data range">
                </label><br>
                <label>Y Max
                  <input type="number" id="ng-y-max" value="1" step="0.01" title="Maximum value for Y-axis">
                </label><br>
                <label>Min Boards
                  <input type="number" id="ng-min-boards" value="7" title="Minimum boards required">
                </label><br>
                <label>Model Name
                  <input list="model-list" id="ng-model-name-1" placeholder="Start typing..." title="Select model name">
                  <span id="ng-model-name-and-2" style="display:none">and</span>
                  <input list="model-list" id="ng-model-name-2" style="display:none" placeholder="Start typing..." title="Select model name">
                  <span id="ng-model-name-and-3" style="display:none">and</span>
                  <input list="model-list" id="ng-model-name-3" style="display:none" placeholder="Start typing..." title="Select model name">
                  <span id="ng-model-name-and-4" style="display:none">and</span>
                  <input list="model-list" id="ng-model-name-4" style="display:none" placeholder="Start typing..." title="Select model name">
                </label><br>
                <label>Lines
                  <select id="ng-line-select-1">
                    <option value="all">All Lines</option>
                    <option value="offline">Line Offline</option>
                    <option value="0">Line 0</option>
                    <option value="1">Line 1</option>
                    <option value="2">Line 2</option>
                    <option value="3">Line 3</option>
                  </select>
                  <span id="ng-line-and-2" style="display:none">and</span>
                  <select id="ng-line-select-2" style="display:none">
                    <option value="">-- Select --</option>
                    <option value="offline">Line Offline</option>
                    <option value="0">Line 0</option>
                    <option value="1">Line 1</option>
                    <option value="2">Line 2</option>
                    <option value="3">Line 3</option>
                  </select>
                  <span id="ng-line-and-3" style="display:none">and</span>
                  <select id="ng-line-select-3" style="display:none">
                    <option value="">-- Select --</option>
                    <option value="offline">Line Offline</option>
                    <option value="0">Line 0</option>
                    <option value="1">Line 1</option>
                    <option value="2">Line 2</option>
                    <option value="3">Line 3</option>
                  </select>
                  <span id="ng-line-and-4" style="display:none">and</span>
                  <select id="ng-line-select-4" style="display:none">
                    <option value="">-- Select --</option>
                    <option value="offline">Line Offline</option>
                    <option value="0">Line 0</option>
                    <option value="1">Line 1</option>
                    <option value="2">Line 2</option>
                    <option value="3">Line 3</option>
                  </select>
                </label><br>
                <p class="field-desc">Generate the chart using the selected parameters.</p>
                <button id="run-ng-chart-btn" title="Generate NG control chart">Run Chart</button>
              </div>
            </div>
            <div class="action-card">
              <h2>Std Dev - Avg FC per Assembly</h2>
              <p class="desc">Analyze false call rate distribution per assembly.</p>
              <button id="stddev-chart-btn" title="Show or hide chart options">Chart Settings</button>
              <div id="stddev-chart-settings" style="display:none; margin-top:10px;">
                <label>Start Date
                  <input type="date" id="std-start-date" title="Start date for data range">
                </label><br>
                <label>End Date
                  <input type="date" id="std-end-date" title="End date for data range">
                </label><br>
                <label>Y Max
                  <input type="number" id="std-y-max" value="50" step="0.1" title="Maximum value for Y-axis">
                </label><br>
                <label>Min Boards
                  <input type="number" id="std-min-boards" value="7" title="Minimum boards required">
                </label><br>
                <label>Model Name
                  <input list="model-list" id="std-model-name-1" placeholder="Start typing..." title="Select model name">
                  <span id="std-model-name-and-2" style="display:none">and</span>
                  <input list="model-list" id="std-model-name-2" style="display:none" placeholder="Start typing..." title="Select model name">
                  <span id="std-model-name-and-3" style="display:none">and</span>
                  <input list="model-list" id="std-model-name-3" style="display:none" placeholder="Start typing..." title="Select model name">
                  <span id="std-model-name-and-4" style="display:none">and</span>
                  <input list="model-list" id="std-model-name-4" style="display:none" placeholder="Start typing..." title="Select model name">
                </label><br>
                <label>Lines
                  <select id="std-line-select-1">
                    <option value="all">All Lines</option>
                    <option value="offline">Line Offline</option>
                    <option value="0">Line 0</option>
                    <option value="1">Line 1</option>
                    <option value="2">Line 2</option>
                    <option value="3">Line 3</option>
                  </select>
                  <span id="std-line-and-2" style="display:none">and</span>
                  <select id="std-line-select-2" style="display:none">
                    <option value="">-- Select --</option>
                    <option value="offline">Line Offline</option>
                    <option value="0">Line 0</option>
                    <option value="1">Line 1</option>
                    <option value="2">Line 2</option>
                    <option value="3">Line 3</option>
                  </select>
                  <span id="std-line-and-3" style="display:none">and</span>
                  <select id="std-line-select-3" style="display:none">
                    <option value="">-- Select --</option>
                    <option value="offline">Line Offline</option>
                    <option value="0">Line 0</option>
                    <option value="1">Line 1</option>
                    <option value="2">Line 2</option>
                    <option value="3">Line 3</option>
                  </select>
                  <span id="std-line-and-4" style="display:none">and</span>
                  <select id="std-line-select-4" style="display:none">
                    <option value="">-- Select --</option>
                    <option value="offline">Line Offline</option>
                    <option value="0">Line 0</option>
                    <option value="1">Line 1</option>
                    <option value="2">Line 2</option>
                    <option value="3">Line 3</option>
                  </select>
                </label><br>
                <p class="field-desc">Generate the chart using the selected parameters.</p>
              <button id="run-std-chart-btn" title="Generate standard deviation chart">Run Chart</button>
            </div>
          </div>
          <div class="action-card">
            <h2>Std Dev - Avg NG per Assembly</h2>
            <p class="desc">Analyze NG rate distribution per assembly.</p>
            <button id="ng-stddev-chart-btn" title="Show or hide chart options">Chart Settings</button>
            <div id="ng-stddev-chart-settings" style="display:none; margin-top:10px;">
              <label>Start Date
                <input type="date" id="ng-std-start-date" title="Start date for data range">
              </label><br>
              <label>End Date
                <input type="date" id="ng-std-end-date" title="End date for data range">
              </label><br>
              <label>Y Max
                <input type="number" id="ng-std-y-max" value="1" step="0.01" title="Maximum value for Y-axis">
              </label><br>
              <label>Min Boards
                <input type="number" id="ng-std-min-boards" value="7" title="Minimum boards required">
              </label><br>
              <label>Model Name
                <input list="model-list" id="ng-std-model-name-1" placeholder="Start typing..." title="Select model name">
                <span id="ng-std-model-name-and-2" style="display:none">and</span>
                <input list="model-list" id="ng-std-model-name-2" style="display:none" placeholder="Start typing..." title="Select model name">
                <span id="ng-std-model-name-and-3" style="display:none">and</span>
                <input list="model-list" id="ng-std-model-name-3" style="display:none" placeholder="Start typing..." title="Select model name">
                <span id="ng-std-model-name-and-4" style="display:none">and</span>
                <input list="model-list" id="ng-std-model-name-4" style="display:none" placeholder="Start typing..." title="Select model name">
              </label><br>
              <label>Lines
                <select id="ng-std-line-select-1">
                  <option value="all">All Lines</option>
                  <option value="offline">Line Offline</option>
                  <option value="0">Line 0</option>
                  <option value="1">Line 1</option>
                  <option value="2">Line 2</option>
                  <option value="3">Line 3</option>
                </select>
                <span id="ng-std-line-and-2" style="display:none">and</span>
                <select id="ng-std-line-select-2" style="display:none">
                  <option value="">-- Select --</option>
                  <option value="offline">Line Offline</option>
                  <option value="0">Line 0</option>
                  <option value="1">Line 1</option>
                  <option value="2">Line 2</option>
                  <option value="3">Line 3</option>
                </select>
                <span id="ng-std-line-and-3" style="display:none">and</span>
                <select id="ng-std-line-select-3" style="display:none">
                  <option value="">-- Select --</option>
                  <option value="offline">Line Offline</option>
                  <option value="0">Line 0</option>
                  <option value="1">Line 1</option>
                  <option value="2">Line 2</option>
                  <option value="3">Line 3</option>
                </select>
                <span id="ng-std-line-and-4" style="display:none">and</span>
                <select id="ng-std-line-select-4" style="display:none">
                  <option value="">-- Select --</option>
                  <option value="offline">Line Offline</option>
                  <option value="0">Line 0</option>
                  <option value="1">Line 1</option>
                  <option value="2">Line 2</option>
                  <option value="3">Line 3</option>
                </select>
              </label><br>
              <p class="field-desc">Generate the chart using the selected parameters.</p>
              <button id="run-ng-std-chart-btn" title="Generate NG standard deviation chart">Run Chart</button>
            </div>
          </div>
          <div class="action-card">
            <h2>Run SQL Query</h2>
            <form id="sql-form">
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
              <div class="saved-query-bar">
                  <select id="saved-queries">
                    <option value="">-- Saved Queries --</option>
                  </select>
                </div>
                <textarea id="sql-query" rows="5" cols="60"></textarea><br>
                <button type="submit">Execute</button>
              </form>
              <table id="sql-results">
                <thead></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>
        <div id="reports-tab" class="tab-content">
          <div class="report-section" id="daily-report">
            <h2>Daily Report</h2>
            <div class="chart-container">
              <canvas id="daily-report-canvas" height="200" style="display:none"></canvas>
            </div>
            <table id="daily-report-table" style="display:none"></table>
            <label>Margin:
              <select id="daily-margin">
                <option value="0.25">0.25"</option>
                <option value="0.5" selected>0.5"</option>
                <option value="0.75">0.75"</option>
                <option value="1">1"</option>
              </select>
            </label>
            <div class="dropdown">
              <button>Download</button>
              <div class="dropdown-content">
                <a href="#" id="download-daily-pdf">PDF</a>
                <a href="#" id="download-daily-xlsx">Excel</a>
              </div>
            </div>
            <p id="daily-report-summary" class="chart-summary"></p>
          </div>
          <div class="report-section" id="weekly-report">
            <h2>Weekly Report</h2>
            <div class="chart-container">
              <canvas id="weekly-report-canvas" height="200" style="display:none"></canvas>
            </div>
            <table id="weekly-report-table" style="display:none"></table>
            <label>Margin:
              <select id="weekly-margin">
                <option value="0.25">0.25"</option>
                <option value="0.5" selected>0.5"</option>
                <option value="0.75">0.75"</option>
                <option value="1">1"</option>
              </select>
            </label>
            <div class="dropdown">
              <button>Download</button>
              <div class="dropdown-content">
                <a href="#" id="download-weekly-pdf">PDF</a>
                <a href="#" id="download-weekly-xlsx">Excel</a>
              </div>
            </div>
            <p id="weekly-report-summary" class="chart-summary"></p>
          </div>
          <div class="report-section" id="monthly-report">
            <h2>Monthly Report</h2>
            <div class="chart-container">
              <canvas id="monthly-report-canvas" height="200" style="display:none"></canvas>
            </div>
            <table id="monthly-report-table" style="display:none"></table>
            <label>Margin:
              <select id="monthly-margin">
                <option value="0.25">0.25"</option>
                <option value="0.5" selected>0.5"</option>
                <option value="0.75">0.75"</option>
                <option value="1">1"</option>
              </select>
            </label>
            <div class="dropdown">
              <button>Download</button>
              <div class="dropdown-content">
                <a href="#" id="download-monthly-pdf">PDF</a>
                <a href="#" id="download-monthly-xlsx">Excel</a>
              </div>
            </div>
            <p id="monthly-report-summary" class="chart-summary"></p>
          </div>
          <div class="report-section" id="yearly-report">
            <h2>Yearly Report</h2>
            <div class="chart-container">
              <canvas id="yearly-report-canvas" height="200" style="display:none"></canvas>
            </div>
            <table id="yearly-report-table" style="display:none"></table>
            <label>Margin:
              <select id="yearly-margin">
                <option value="0.25">0.25"</option>
                <option value="0.5" selected>0.5"</option>
                <option value="0.75">0.75"</option>
                <option value="1">1"</option>
              </select>
            </label>
            <div class="dropdown">
              <button>Download</button>
              <div class="dropdown-content">
                <a href="#" id="download-yearly-pdf">PDF</a>
                <a href="#" id="download-yearly-xlsx">Excel</a>
              </div>
            </div>
            <p id="yearly-report-summary" class="chart-summary"></p>
          </div>
        </div>
      </div>
      <datalist id="model-list">
        {% for name in model_names %}
        <option value="{{ name }}"></option>
        {% endfor %}
      </datalist>
      <div id="divider"></div>
      <div id="moat-table">
        {% if is_admin or permissions['analysis'] %}
        <button id="ppm-refresh-btn">Report Refresh</button>
        {% endif %}
        <div id="model-filter-container">
          <label for="model-filter">Show Models</label>
          <select id="model-filter">
            <option value="all">All</option>
            <option value="smt">SMT</option>
            <option value="th">TH</option>
          </select>
        </div>
        <table>
          <thead><tr>
            <th>Model Name</th><th>Total Boards</th><th>Total Parts/Board</th>
            <th>Total Parts</th><th>NG Parts</th><th>NG PPM</th>
            <th>FalseCall Parts</th><th>FalseCall PPM</th><th>Report Date</th><th>Line</th>
          </tr></thead>
          <tbody>
          {% for row in moat %}
          <tr>
            <td>{{ row['model_name'] }}</td>
            <td>{{ row['total_boards'] }}</td>
            <td>{{ row['total_parts_per_board'] }}</td>
            <td>{{ row['total_parts'] }}</td>
            <td>{{ row['ng_parts'] }}</td>
            <td>{{ row['ng_ppm'] }}</td>
            <td>{{ row['falsecall_parts'] }}</td>
            <td>{{ row['falsecall_ppm'] }}</td>
            <td>{{ row['report_date'] }}</td>
            <td>{{ row['line'] }}</td>
          </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- Uploads Modal -->
    <div class="modal fade" id="uploads-modal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Uploaded Files</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <ul id="uploads-list"></ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Chart Modal -->
    <div class="modal fade" id="chart-modal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Control Chart - Avg FalseCall Rate</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="chart-container">
              <canvas id="chart-canvas" height="200"></canvas>
            </div>
            <p id="fc-chart-summary" class="chart-summary"></p>
            <table id="fc-data-table"></table>
            <label>Margin:
              <select id="fc-margin">
                <option value="0.25">0.25"</option>
                <option value="0.5" selected>0.5"</option>
                <option value="0.75">0.75"</option>
                <option value="1">1"</option>
              </select>
            </label>
            <button id="download-fc-pdf">Download PDF</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="chart-ng-modal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Control Chart - Avg NG Rate</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="chart-container">
              <canvas id="chart-ng-canvas" height="200"></canvas>
            </div>
            <p id="ng-chart-summary" class="chart-summary"></p>
            <table id="ng-data-table"></table>
            <label>Margin:
              <select id="ng-margin">
                <option value="0.25">0.25"</option>
                <option value="0.5" selected>0.5"</option>
                <option value="0.75">0.75"</option>
                <option value="1">1"</option>
              </select>
            </label>
            <button id="download-ng-pdf">Download PDF</button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal fade" id="chart-stddev-modal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Std Dev - Avg FC per Assembly</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="chart-container">
              <canvas id="chart-stddev-canvas" height="200"></canvas>
            </div>
            <p id="stddev-chart-summary" class="chart-summary"></p>
            <table id="std-data-table"></table>
            <label>Margin:
              <select id="std-margin">
                <option value="0.25">0.25"</option>
                <option value="0.5" selected>0.5"</option>
                <option value="0.75">0.75"</option>
                <option value="1">1"</option>
              </select>
            </label>
            <button id="download-std-pdf">Download PDF</button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal fade" id="chart-ng-stddev-modal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Std Dev - Avg NG per Assembly</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="chart-container">
              <canvas id="chart-ng-stddev-canvas" height="200"></canvas>
            </div>
            <p id="ng-stddev-chart-summary" class="chart-summary"></p>
            <table id="ng-std-data-table"></table>
            <label>Margin:
              <select id="ng-std-margin">
                <option value="0.25">0.25"</option>
                <option value="0.5" selected>0.5"</option>
                <option value="0.75">0.75"</option>
                <option value="1">1"</option>
              </select>
            </label>
            <button id="download-ng-std-pdf">Download PDF</button>
          </div>
        </div>
      </div>
    </div>
    {% endif %}
    {% if startup_ppm_msg %}
    <script>
      window.addEventListener('DOMContentLoaded', function() {
        alert({{ startup_ppm_msg|tojson }});
      });
    </script>
    {% endif %}
  {% endblock %}
