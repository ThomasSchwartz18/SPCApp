{% extends 'base.html' %}
{% block title %}AOI vs Final Inspect Comparison{% endblock %}
{% block head_extra %}
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
  <script id="aoi-series" type="application/json">{{ aoi_series|tojson }}</script>
  <script id="fi-series" type="application/json">{{ fi_series|tojson }}</script>
  <script id="aoi-data" type="application/json">{{ aoi_rows|tojson }}</script>
  <script id="fi-data" type="application/json">{{ fi_rows|tojson }}</script>
  <script id="grade-data" type="application/json">{{ grades|tojson }}</script>
  <script src="{{ url_for('static', filename='js/tabs.js') }}" defer></script>
  <script src="{{ url_for('static', filename='js/operator_grades.js') }}" defer></script>
  <script src="{{ url_for('static', filename='js/aoi_fi_compare.js') }}" defer></script>
{% endblock %}
{% block content %}
  <a href="{{ url_for('home') }}">&larr; Back to Home</a>
  <h1>AOI vs Final Inspect Comparison</h1>
  <form method="get" style="margin-bottom:20px;">
    <label>Start: <input type="date" name="start" value="{{ start or '' }}"></label>
    <label>End: <input type="date" name="end" value="{{ end or '' }}"></label>
    <button type="submit">Apply</button>
  </form>
  <h2>AOI Operator Grades</h2>
  <canvas id="operatorGradesChart"></canvas>
  <h2>Yield Comparison</h2>
  <canvas id="yieldOverlayChart"></canvas>
  <div class="comparison-panels" style="display:flex; gap:20px; flex-wrap:wrap; margin-top:20px;">
    <details class="panel" style="flex:1;" open>
      <summary>AOI Reports</summary>
      <table>
        <thead>
          <tr>
            <th>Date</th>
            <th>Shift</th>
            <th>Operator</th>
            <th>Customer</th>
            <th>Assembly</th>
            <th>Rev</th>
            <th>Job</th>
            <th>Inspected</th>
            <th>Rejected</th>
            <th>Info</th>
          </tr>
        </thead>
        <tbody>
          {% for r in aoi_rows %}
          <tr>
            <td>{{ r['report_date'] }}</td>
            <td>{{ r['shift'] }}</td>
            <td>{{ r['operator'] }}</td>
            <td>{{ r['customer'] }}</td>
            <td>{{ r['assembly'] }}</td>
            <td>{{ r['rev'] }}</td>
            <td>{{ r['job_number'] }}</td>
            <td>{{ r['qty_inspected'] }}</td>
            <td>{{ r['qty_rejected'] }}</td>
            <td>{{ r['additional_info'] }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </details>
    <details class="panel" style="flex:1;" open>
      <summary>Final Inspect Reports</summary>
      <table>
        <thead>
          <tr>
            <th>Date</th>
            <th>Shift</th>
            <th>Operator</th>
            <th>Customer</th>
            <th>Assembly</th>
            <th>Rev</th>
            <th>Job</th>
            <th>Inspected</th>
            <th>Rejected</th>
            <th>Info</th>
          </tr>
        </thead>
        <tbody>
          {% for r in fi_rows %}
          <tr>
            <td>{{ r['report_date'] }}</td>
            <td>{{ r['shift'] }}</td>
            <td>{{ r['operator'] }}</td>
            <td>{{ r['customer'] }}</td>
            <td>{{ r['assembly'] }}</td>
            <td>{{ r['rev'] }}</td>
            <td>{{ r['job_number'] }}</td>
            <td>{{ r['qty_inspected'] }}</td>
            <td>{{ r['qty_rejected'] }}</td>
            <td>{{ r['additional_info'] }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </details>
  </div>
{% endblock %}

