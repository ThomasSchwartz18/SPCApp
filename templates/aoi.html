{% extends 'base.html' %}
{% block title %}AOI{% endblock %}
{% block head_extra %}
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js" defer></script>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js" defer></script>
  <script src="{{ url_for('static', filename='js/html2canvas.min.js') }}" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.plugin.png.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.plugin.jpeg.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.25/dist/jspdf.plugin.autotable.min.js" defer></script>
  <script src="{{ url_for('static', filename='js/report_utils.js') }}" defer></script>
  <script src="{{ url_for('static', filename='js/report_collector.js') }}" defer></script>
  <script src="{{ url_for('static', filename='js/tabs.js') }}" defer></script>
{% endblock %}
{% block content %}
  <a href="/">‚Üê Home</a>
  <h1>AOI</h1>
  <nav class="tab-nav">
    <button class="tab-link {% if active_tab == 'daily' %}active{% endif %}" data-tab="daily" data-scripts="{{ url_for('static', filename='js/aoi_dashboard.js') }} {{ url_for('static', filename='js/aoi_sql.js') }}">Daily Report</button>
    <button class="tab-link {% if active_tab == 'ppm' %}active{% endif %}" data-tab="ppm" data-scripts="{{ url_for('static', filename='js/analysis.js') }} {{ url_for('static', filename='js/moat_sql.js') }}">PPM Analysis</button>
    <button class="tab-link {% if active_tab == 'reports' %}active{% endif %}" data-tab="reports" data-scripts="{{ url_for('static', filename='js/generate_reports.js') }}">Report Generation</button>
  </nav>
  <div id="daily" class="tab-content {% if active_tab == 'daily' %}active{% endif %}">
    {% include 'daily_section.html' %}
  </div>
  <div id="ppm" class="tab-content {% if active_tab == 'ppm' %}active{% endif %}">
    {% include 'analysis_section.html' %}
  </div>
  <div id="reports" class="tab-content {% if active_tab == 'reports' %}active{% endif %}">
    {% include 'reports_section.html' %}
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      function loadScripts(list) {
        list.split(' ').forEach(src => {
          if (!src) return;
          if (!document.querySelector(`script[src='${src}']`)) {
            const s = document.createElement('script');
            s.src = src;
            document.body.appendChild(s);
          }
        });
      }
      document.querySelectorAll('.tab-link').forEach(btn => {
        btn.addEventListener('click', () => {
          if (btn.dataset.scripts) loadScripts(btn.dataset.scripts);
        });
        if (btn.classList.contains('active') && btn.dataset.scripts) {
          loadScripts(btn.dataset.scripts);
        }
      });
    });
  </script>
{% endblock %}
