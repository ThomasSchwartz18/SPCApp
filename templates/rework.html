{% extends 'base.html' %}
{% import 'components/forms.html' as forms %}
{% block title %}Rework - Stencil Lookup{% endblock %}
{% block head_extra %}
  <script src="{{ url_for('static', filename='js/report_utils.js') }}" defer></script>
  <script src="/static/js/stencil_lookup.js" defer></script>
{% endblock %}
{% block content %}
  <h1>Stencil/Part Number Lookup</h1>
  <div id="container">
    <div id="stencil-actions">
      <div class="action-panel">
        <div class="action-card">
          <h2>Search Stencil</h2>
          <p class="desc">Enter a part number to highlight matching stencils.</p>
          {{ forms.text_input('search-part-number', 'Part Number', placeholder='e.g., 10-1000', help='Highlight matching part number in the table.', id='search-part-number', title='Part number to locate') }}
          {{ forms.button('Search', type='button', id='search-btn', title='Highlight matching part number') }}
        </div>
        <div class="action-card">
          <h2>Add New Entry</h2>
          <p class="desc">Use this form to add a stencil and associated parts.</p>
          <form method="post" class="needs-validation" novalidate>
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            {{ forms.text_input('stencil_number', 'Stencil Number', required=True, title='Stencil number') }}
            {{ forms.text_input('part_number', 'Part Number(s)', required=True, title='Comma separated part numbers') }}
            {{ forms.text_input('ref', 'Ref', title='Reference designator') }}
            {{ forms.text_input('description', 'Description', title='Description') }}
            {{ forms.text_input('location_of_stencil', 'Location Of Stencil', title='Location of stencil') }}
            <p class="field-desc">Add the stencil to the table.</p>
            {{ forms.button('Add', title='Add new stencil') }}
          </form>
        </div>
      </div>
    </div>
    <div id="divider"></div>
    <div id="stencil-table">
      <table id="stencil-data-table" class="editable" data-update-url="/rework" data-fields="stencil_number,part_number,ref,description,location_of_stencil">
        <thead>
          <tr>
            <th>Stencil Number</th>
            <th>Part Number</th>
            <th>Ref</th>
            <th>Description</th>
            <th>Location Of Stencil</th>
            {% if is_admin %}
            <th>Actions</th>
            {% endif %}
          </tr>
        </thead>
        <tbody>
          {% for row in stencils %}
          <tr data-id="{{ row['id'] }}">
            <td>{{ row['stencil_number'] }}</td>
            <td class="part-number">{{ row['part_number'] }}</td>
            <td>{{ row['ref'] }}</td>
            <td>{{ row['description'] }}</td>
            <td>{{ row['location_of_stencil'] }}</td>
            {% if is_admin %}
            <td class="no-edit"><button type="button" class="delete-row" title="Delete row">Delete</button></td>
            {% endif %}
          </tr>
          {% endfor %}
        </tbody>
      </table>
      <button type="button" onclick="exportTableToExcel('#stencil-data-table','stencil_lookup.csv')">Export CSV</button>
    </div>
  </div>
{% endblock %}
