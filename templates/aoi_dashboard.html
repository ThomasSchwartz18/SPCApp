{% extends 'base.html' %}
{% block title %}AOI Dashboard{% endblock %}
{% block head_extra %}
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js" defer></script>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js" defer></script>
  <script id="operator-data" type="application/json">{{ operators|tojson }}</script>
  <script id="shift-data" type="application/json">{{ shift_totals|tojson }}</script>
  <script id="customer-data" type="application/json">{{ customer_rates|tojson }}</script>
  <script id="yield-data" type="application/json">{{ yield_series|tojson }}</script>
  <script src="{{ url_for('static', filename='js/aoi_dashboard.js') }}" defer></script>
{% endblock %}
{% block content %}
  <a href="{{ url_for('aoi_report') }}">‚Üê AOI</a>
  <h1>AOI Dashboard</h1>
  <form method="get" class="filters">
    <label>Start: <input type="date" name="start" value="{{ start or '' }}"></label>
    <label>End: <input type="date" name="end" value="{{ end or '' }}"></label>
    <label>Customer:
      <select name="customer">
        <option value="">All</option>
        {% for c in customers %}
        <option value="{{ c }}" {% if c == selected_customer %}selected{% endif %}>{{ c }}</option>
        {% endfor %}
      </select>
    </label>
    <label>Shift:
      <select name="shift">
        <option value="">All</option>
        {% for s in shifts %}
        <option value="{{ s }}" {% if s == selected_shift %}selected{% endif %}>{{ s }}</option>
        {% endfor %}
      </select>
    </label>
    <button type="submit">Apply</button>
  </form>
  <h2>Top Operators by Inspected Quantity</h2>
  <canvas id="operatorsChart"></canvas>
  <h2>Shift Totals</h2>
  <canvas id="shiftChart"></canvas>
  <h2>Customer Reject Rates</h2>
  <canvas id="customerChart"></canvas>
  <h2>Overall Yield Over Time</h2>
  <canvas id="yieldChart"></canvas>
  <h2>Assembly Performance</h2>
  <table id="assemblyTable">
    <thead>
      <tr>
        <th>Assembly</th>
        <th>Inspected</th>
        <th>Rejected</th>
        <th>Yield</th>
      </tr>
    </thead>
    <tbody>
      {% for row in assemblies %}
      <tr>
        <td>{{ row['assembly'] }}</td>
        <td>{{ row['inspected'] }}</td>
        <td>{{ row['rejected'] }}</td>
        <td>{{ '{:.2%}'.format(row['yield']) }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
{% endblock %}

